const cmd = require('node-cmd');
const nmap = require('node-nmap');
const express = require('express');
const request = require('request');
const bodyParser = require('body-parser');
const path = require('path');
const app = express();
const exec = require('child_process').exec;
var mysql = require('mysql');
var fs = require('fs');


var port = process.env.PORT || 8000;
if (process.env.VCAP_APPLICATION) {
	port = process.env.PORT;
}

var con = mysql.createConnection({
  host: "localhost",
  user: "root",
  //password: "Pentest123!@#",
  password: "123",
  database: "nodepentest"
});
con.connect(function(err) {
 	if (err) throw err;
	console.log("Connected!");
});

app.use(bodyParser.json());

app.listen(port, function () {
	console.log('app running on port: %d', port);
});

/////////////////////////////////////////////////////
/////////////////////////////////////////////////////
//
////////////////////////////////////////////////////
////////////////////////////////////////////////////
app.get('/api/nmap', async function (req, res) {
	var str = req.query.host;
	var hosts = str.split("https://").pop();
	hosts = hosts.split("http://").pop();
	var command = 'nmap '+hosts;
	var datetime = new Date();
	var insert_sql = "INSERT INTO RESULTS(type,status,host,start_date) VALUES('nmap','PENDING','"+req.query.host+"','"+datetime+"');";

	con.query(insert_sql, function (err, result, fields) {
    if(!err){

    	res.status(200).send({ message: result.insertId });

    		var filename = ""+result.insertId+"_"+Math.floor(Math.random() * 100000000)+".txt";
    		try {
				exec(command,function(err,stdout,stderr){

				if(!err){

					var update_sql = "UPDATE RESULTS SET status='COMPLETE', end_date='"+ new Date()+"',file_name='"+filename+"' where id="+result.insertId+";";
					console.log(update_sql);
					con.query(update_sql, function (err, result, fields) {
						if(!err){
							console.log('Record Updated');
						}
						else{
							console.log("Update Query Error: "+err);
						}
					});

				fs.writeFile('./Results/'+filename+'',stdout, function (err) {
  				if (err) throw err;
  				console.log("File Write Status: "+stdout);
  				});
  
			}

			else{
				fs.writeFile('./Results/'+filename+'',stderr, function (err) {
  				if (err) throw err;
  				console.log("File write Error: "+stderr);
  				});
				}
			});
		}
		catch(_error)
		{
			var update_sql = "UPDATE RESULTS SET status='COMPLETE', end_date='"+ new Date()+"',file_name='"+filename+"' where id="+result.insertId+";";
					console.log(update_sql);
					con.query(update_sql, function (err, result, fields) {
						if(!err){
							console.log('Record Updated');
						}
						else{
							console.log("Update Query Error: "+err);
						}
			});
			fs.writeFile('./Results/'+filename+'',_error, function (err) {
  			if (err) throw err;
  			console.log("File write Error: "+_error);
  			});
		}
	}
	else{res.status(500).send({ message: err });}
	});
});

app.get('/api/nmap_sv ', async function (req, res) {
	var str = req.query.host;
	var hosts = str.split("https://").pop();
	hosts = hosts.split("http://").pop();
	var command = 'nmap -sV '+hosts;
	var datetime = new Date();
	var insert_sql = "INSERT INTO RESULTS(type,status,host,start_date) VALUES('nmap -sV','PENDING','"+req.query.host+"','"+datetime+"');";

	con.query(insert_sql, function (err, result, fields) {
    if(!err){

    	res.status(200).send({ message: result.insertId });

    		var filename = ""+result.insertId+"_"+Math.floor(Math.random() * 100000000)+".txt";
    		try {
				exec(command,function(err,stdout,stderr){

				if(!err){

					var update_sql = "UPDATE RESULTS SET status='COMPLETE', end_date='"+ new Date()+"',file_name='"+filename+"' where id="+result.insertId+";";
					console.log(update_sql);
					con.query(update_sql, function (err, result, fields) {
						if(!err){
							console.log('Record Updated');
						}
						else{
							console.log("Update Query Error: "+err);
						}
					});

				fs.writeFile('./Results/'+filename+'',stdout, function (err) {
  				if (err) throw err;
  				console.log("File Write Status: "+stdout);
  				});
  
			}

			else{
				fs.writeFile('./Results/'+filename+'',stderr, function (err) {
  				if (err) throw err;
  				console.log("File write Error: "+stderr);
  				});
				}
			});
		}
		catch(_error)
		{
			var update_sql = "UPDATE RESULTS SET status='COMPLETE', end_date='"+ new Date()+"',file_name='"+filename+"' where id="+result.insertId+";";
					console.log(update_sql);
					con.query(update_sql, function (err, result, fields) {
						if(!err){
							console.log('Record Updated');
						}
						else{
							console.log("Update Query Error: "+err);
						}
			});
			fs.writeFile('./Results/'+filename+'',_error, function (err) {
  			if (err) throw err;
  			console.log("File write Error: "+_error);
  			});
		}
	}
	else{res.status(500).send({ message: err });}
	});
});

app.get('/api/nmap-informationgathering', async function (req, res) {
	var str = req.query.host;
	var hosts = str.split("https://").pop();
	hosts = hosts.split("http://").pop();
	var command = 'nmap --script=asn-query,ip-geolocation-maxmind '+hosts;
	var datetime = new Date();
	var insert_sql = "INSERT INTO RESULTS(type,status,host,start_date) VALUES('nmap Information Gathering','PENDING','"+req.query.host+"','"+datetime+"');";

	con.query(insert_sql, function (err, result, fields) {
    if(!err){

    	res.status(200).send({ message: result.insertId });

    		var filename = ""+result.insertId+"_"+Math.floor(Math.random() * 100000000)+".txt";
    		try {
				exec(command,function(err,stdout,stderr){

				if(!err){

					var update_sql = "UPDATE RESULTS SET status='COMPLETE', end_date='"+ new Date()+"',file_name='"+filename+"' where id="+result.insertId+";";
					console.log(update_sql);
					con.query(update_sql, function (err, result, fields) {
						if(!err){
							console.log('Record Updated');
						}
						else{
							console.log("Update Query Error: "+err);
						}
					});

				fs.writeFile('./Results/'+filename+'',stdout, function (err) {
  				if (err) throw err;
  				console.log("File Write Status: "+stdout);
  				});
  
			}

			else{
				fs.writeFile('./Results/'+filename+'',stderr, function (err) {
  				if (err) throw err;
  				console.log("File write Error: "+stderr);
  				});
				}
			});
		}
		catch(_error)
		{
			var update_sql = "UPDATE RESULTS SET status='COMPLETE', end_date='"+ new Date()+"',file_name='"+filename+"' where id="+result.insertId+";";
					console.log(update_sql);
					con.query(update_sql, function (err, result, fields) {
						if(!err){
							console.log('Record Updated');
						}
						else{
							console.log("Update Query Error: "+err);
						}
			});
			fs.writeFile('./Results/'+filename+'',_error, function (err) {
  			if (err) throw err;
  			console.log("File write Error: "+_error);
  			});
		}
	}
	else{res.status(500).send({ message: err });}
	});
});

app.get('/api/nmap-httpheaders', async function (req, res) {
	var str = req.query.host;
	var hosts = str.split("https://").pop();
	hosts = hosts.split("http://").pop();
	var command = 'nmap --script=http-headers '+hosts;
	var datetime = new Date();
	var insert_sql = "INSERT INTO RESULTS(type,status,host,start_date) VALUES('nmap http headers','PENDING','"+req.query.host+"','"+datetime+"');";

	con.query(insert_sql, function (err, result, fields) {
    if(!err){

    	res.status(200).send({ message: result.insertId });

    		var filename = ""+result.insertId+"_"+Math.floor(Math.random() * 100000000)+".txt";
    		try {
				exec(command,function(err,stdout,stderr){

				if(!err){

					var update_sql = "UPDATE RESULTS SET status='COMPLETE', end_date='"+ new Date()+"',file_name='"+filename+"' where id="+result.insertId+";";
					console.log(update_sql);
					con.query(update_sql, function (err, result, fields) {
						if(!err){
							console.log('Record Updated');
						}
						else{
							console.log("Update Query Error: "+err);
						}
					});

				fs.writeFile('./Results/'+filename+'',stdout, function (err) {
  				if (err) throw err;
  				console.log("File Write Status: "+stdout);
  				});
  
			}

			else{
				fs.writeFile('./Results/'+filename+'',stderr, function (err) {
  				if (err) throw err;
  				console.log("File write Error: "+stderr);
  				});
				}
			});
		}
		catch(_error)
		{
			var update_sql = "UPDATE RESULTS SET status='COMPLETE', end_date='"+ new Date()+"',file_name='"+filename+"' where id="+result.insertId+";";
					console.log(update_sql);
					con.query(update_sql, function (err, result, fields) {
						if(!err){
							console.log('Record Updated');
						}
						else{
							console.log("Update Query Error: "+err);
						}
			});
			fs.writeFile('./Results/'+filename+'',_error, function (err) {
  			if (err) throw err;
  			console.log("File write Error: "+_error);
  			});
		}
	}
	else{res.status(500).send({ message: err });}
	});
});

app.get('/api/nmap-osandservices', async function (req, res) {
	var str = req.query.host;
	var hosts = str.split("https://").pop();
	hosts = hosts.split("http://").pop();
	var command = 'nmap -A '+hosts;
	var datetime = new Date();
	var insert_sql = "INSERT INTO RESULTS(type,status,host,start_date) VALUES('nmap Os and Services','PENDING','"+req.query.host+"','"+datetime+"');";

	con.query(insert_sql, function (err, result, fields) {
    if(!err){

    	res.status(200).send({ message: result.insertId });

    		var filename = ""+result.insertId+"_"+Math.floor(Math.random() * 100000000)+".txt";
    		try {
				exec(command,function(err,stdout,stderr){

				if(!err){

					var update_sql = "UPDATE RESULTS SET status='COMPLETE', end_date='"+ new Date()+"',file_name='"+filename+"' where id="+result.insertId+";";
					console.log(update_sql);
					con.query(update_sql, function (err, result, fields) {
						if(!err){
							console.log('Record Updated');
						}
						else{
							console.log("Update Query Error: "+err);
						}
					});

				fs.writeFile('./Results/'+filename+'',stdout, function (err) {
  				if (err) throw err;
  				console.log("File Write Status: "+stdout);
  				});
  
			}

			else{
				fs.writeFile('./Results/'+filename+'',stderr, function (err) {
  				if (err) throw err;
  				console.log("File write Error: "+stderr);
  				});
				}
			});
		}
		catch(_error)
		{
			var update_sql = "UPDATE RESULTS SET status='COMPLETE', end_date='"+ new Date()+"',file_name='"+filename+"' where id="+result.insertId+";";
					console.log(update_sql);
					con.query(update_sql, function (err, result, fields) {
						if(!err){
							console.log('Record Updated');
						}
						else{
							console.log("Update Query Error: "+err);
						}
			});
			fs.writeFile('./Results/'+filename+'',_error, function (err) {
  			if (err) throw err;
  			console.log("File write Error: "+_error);
  			});
		}
	}
	else{res.status(500).send({ message: err });}
	});
});

app.get('/api/nmap-heartbleed', async function (req, res) {
	var str = req.query.host;
	var hosts = str.split("https://").pop();
	hosts = hosts.split("http://").pop();
	var command = 'nmap -sV -p 443 --script=ssl-heartbleed '+hosts;
	var datetime = new Date();
	var insert_sql = "INSERT INTO RESULTS(type,status,host,start_date) VALUES('nmap Heartbsleed','PENDING','"+req.query.host+"','"+datetime+"');";

	con.query(insert_sql, function (err, result, fields) {
    if(!err){

    	res.status(200).send({ message: result.insertId });

    		var filename = ""+result.insertId+"_"+Math.floor(Math.random() * 100000000)+".txt";
    		try {
				exec(command,function(err,stdout,stderr){

				if(!err){

					var update_sql = "UPDATE RESULTS SET status='COMPLETE', end_date='"+ new Date()+"',file_name='"+filename+"' where id="+result.insertId+";";
					console.log(update_sql);
					con.query(update_sql, function (err, result, fields) {
						if(!err){
							console.log('Record Updated');
						}
						else{
							console.log("Update Query Error: "+err);
						}
					});

				fs.writeFile('./Results/'+filename+'',stdout, function (err) {
  				if (err) throw err;
  				console.log("File Write Status: "+stdout);
  				});
  
			}

			else{
				fs.writeFile('./Results/'+filename+'',stderr, function (err) {
  				if (err) throw err;
  				console.log("File write Error: "+stderr);
  				});
				}
			});
		}
		catch(_error)
		{
			var update_sql = "UPDATE RESULTS SET status='COMPLETE', end_date='"+ new Date()+"',file_name='"+filename+"' where id="+result.insertId+";";
					console.log(update_sql);
					con.query(update_sql, function (err, result, fields) {
						if(!err){
							console.log('Record Updated');
						}
						else{
							console.log("Update Query Error: "+err);
						}
			});
			fs.writeFile('./Results/'+filename+'',_error, function (err) {
  			if (err) throw err;
  			console.log("File write Error: "+_error);
  			});
		}
	}
	else{res.status(500).send({ message: err });}
	});
});

app.get('/api/nmap-ports', async function (req, res) {

	var str = req.query.host;
	var hosts = str.split("https://").pop();
	hosts = hosts.split("http://").pop();
	var command = 'nmap -p '+ req.query.port + ' ' + hosts ;
	console.log(command);
	var datetime = new Date();
	var insert_sql = "INSERT INTO RESULTS(type,status,host,start_date) VALUES('nmap-ports','PENDING','"+req.query.host+"','"+datetime+"');";

	con.query(insert_sql, function (err, result, fields) {
    if(!err){

    	res.status(200).send({ message: result.insertId });
		var filename = ""+result.insertId+"_"+Math.floor(Math.random() * 100000000)+".txt";
		try {
			exec(command,function(err,stdout,stderr){


				if(!err){

					var update_sql = "UPDATE RESULTS SET status='COMPLETE', end_date='"+ new Date()+"',file_name='"+filename+"' where id="+result.insertId+";";
					console.log(update_sql);
					con.query(update_sql, function (err, result, fields) {
						if(!err){
							console.log('Record Updated');
						}
						else{
							console.log("Update Query Error: "+err);
						}
					});

				fs.writeFile('./Results/'+filename+'',stdout, function (err) {
  				if (err) throw err;
  				console.log("File Write Status: "+stdout);
  				});
  
			}

			else{
				fs.writeFile('./Results/'+filename+'',stderr, function (err) {
  				if (err) throw err;
  				console.log("File write Error: "+stderr);
  				});
			}
		});
		}
		catch(_error){
		var update_sql = "UPDATE RESULTS SET status='COMPLETE', end_date='"+ new Date()+"',file_name='"+filename+"' where id="+result.insertId+";";
					console.log(update_sql);
					con.query(update_sql, function (err, result, fields) {
						if(!err){
							console.log('Record Updated');
						}
						else{
							console.log("Update Query Error: "+err);
						}
			});
			fs.writeFile('./Results/'+filename+'',_error, function (err) {
  			if (err) throw err;
  			console.log("File write Error: "+_error);
  			});
		}
	}
	else{res.status(500).send({ message: err });}
	});
});

app.get('/api/nmap-dos', async function (req, res) {
	var str = req.query.host;
	var hosts = str.split("https://").pop();
	hosts = hosts.split("http://").pop();
	var command = ' nmap -v --script dos '+hosts;
	var datetime = new Date();
	var insert_sql = "INSERT INTO RESULTS(type,status,host,start_date) VALUES('nmap DOS vulnerability','PENDING','"+req.query.host+"','"+datetime+"');";

	con.query(insert_sql, function (err, result, fields) {
    if(!err){

    	res.status(200).send({ message: result.insertId });

    		var filename = ""+result.insertId+"_"+Math.floor(Math.random() * 100000000)+".txt";
    		try {
				exec(command,function(err,stdout,stderr){

				if(!err){

					var update_sql = "UPDATE RESULTS SET status='COMPLETE', end_date='"+ new Date()+"',file_name='"+filename+"' where id="+result.insertId+";";
					console.log(update_sql);
					con.query(update_sql, function (err, result, fields) {
						if(!err){
							console.log('Record Updated');
						}
						else{
							console.log("Update Query Error: "+err);
						}
					});

				fs.writeFile('./Results/'+filename+'',stdout, function (err) {
  				if (err) throw err;
  				console.log("File Write Status: "+stdout);
  				});
  
			}

			else{
				fs.writeFile('./Results/'+filename+'',stderr, function (err) {
  				if (err) throw err;
  				console.log("File write Error: "+stderr);
  				});
				}
			});
		}
		catch(_error)
		{
			var update_sql = "UPDATE RESULTS SET status='COMPLETE', end_date='"+ new Date()+"',file_name='"+filename+"' where id="+result.insertId+";";
					console.log(update_sql);
					con.query(update_sql, function (err, result, fields) {
						if(!err){
							console.log('Record Updated');
						}
						else{
							console.log("Update Query Error: "+err);
						}
			});
			fs.writeFile('./Results/'+filename+'',_error, function (err) {
  			if (err) throw err;
  			console.log("File write Error: "+_error);
  			});
		}
	}
	else{res.status(500).send({ message: err });}
	});
});

app.get('/api/nmap-safescript', async function (req, res) {
	var str = req.query.host;
	var hosts = str.split("https://").pop();
	hosts = hosts.split("http://").pop();
	var command = 'nmap -sV -sC '+hosts;
	var datetime = new Date();
	var insert_sql = "INSERT INTO RESULTS(type,status,host,start_date) VALUES('nmap default safe Script','PENDING','"+req.query.host+"','"+datetime+"');";

	con.query(insert_sql, function (err, result, fields) {
    if(!err){

    	res.status(200).send({ message: result.insertId });

    		var filename = ""+result.insertId+"_"+Math.floor(Math.random() * 100000000)+".txt";
    		try {
				exec(command,function(err,stdout,stderr){

				if(!err){

					var update_sql = "UPDATE RESULTS SET status='COMPLETE', end_date='"+ new Date()+"',file_name='"+filename+"' where id="+result.insertId+";";
					console.log(update_sql);
					con.query(update_sql, function (err, result, fields) {
						if(!err){
							console.log('Record Updated');
						}
						else{
							console.log("Update Query Error: "+err);
						}
					});

				fs.writeFile('./Results/'+filename+'',stdout, function (err) {
  				if (err) throw err;
  				console.log("File Write Status: "+stdout);
  				});
  
			}

			else{
				fs.writeFile('./Results/'+filename+'',stderr, function (err) {
  				if (err) throw err;
  				console.log("File write Error: "+stderr);
  				});
				}
			});
		}
		catch(_error)
		{
			var update_sql = "UPDATE RESULTS SET status='COMPLETE', end_date='"+ new Date()+"',file_name='"+filename+"' where id="+result.insertId+";";
					console.log(update_sql);
					con.query(update_sql, function (err, result, fields) {
						if(!err){
							console.log('Record Updated');
						}
						else{
							console.log("Update Query Error: "+err);
						}
			});
			fs.writeFile('./Results/'+filename+'',_error, function (err) {
  			if (err) throw err;
  			console.log("File write Error: "+_error);
  			});
		}
	}
	else{res.status(500).send({ message: err });}
	});
});

app.get('/api/nmap-audit', async function (req, res) {
	var str = req.query.host;
	var hosts = str.split("https://").pop();
	hosts = hosts.split("http://").pop();
	var command = 'nmap -v --script vuln '+hosts;
	var datetime = new Date();
	var insert_sql = "INSERT INTO RESULTS(type,status,host,start_date) VALUES('nmap Advance Audit','PENDING','"+req.query.host+"','"+datetime+"');";

	con.query(insert_sql, function (err, result, fields) {
    if(!err){

    	res.status(200).send({ message: result.insertId });

    		var filename = ""+result.insertId+"_"+Math.floor(Math.random() * 100000000)+".txt";
    		try {
				exec(command,function(err,stdout,stderr){

				if(!err){

					var update_sql = "UPDATE RESULTS SET status='COMPLETE', end_date='"+ new Date()+"',file_name='"+filename+"' where id="+result.insertId+";";
					console.log(update_sql);
					con.query(update_sql, function (err, result, fields) {
						if(!err){
							console.log('Record Updated');
						}
						else{
							console.log("Update Query Error: "+err);
						}
					});

				fs.writeFile('./Results/'+filename+'',stdout, function (err) {
  				if (err) throw err;
  				console.log("File Write Status: "+stdout);
  				});
  
			}

			else{
				fs.writeFile('./Results/'+filename+'',stderr, function (err) {
  				if (err) throw err;
  				console.log("File write Error: "+stderr);
  				});
				}
			});
		}
		catch(_error)
		{
			var update_sql = "UPDATE RESULTS SET status='COMPLETE', end_date='"+ new Date()+"',file_name='"+filename+"' where id="+result.insertId+";";
					console.log(update_sql);
					con.query(update_sql, function (err, result, fields) {
						if(!err){
							console.log('Record Updated');
						}
						else{
							console.log("Update Query Error: "+err);
						}
			});
			fs.writeFile('./Results/'+filename+'',_error, function (err) {
  			if (err) throw err;
  			console.log("File write Error: "+_error);
  			});
		}
	}
	else{res.status(500).send({ message: err });}
	});
});


app.get('/api/nikto', async function (req, res) {

	var command = 'nikto -host '+req.query.host;
	var datetime = new Date();
	var insert_sql = "INSERT INTO RESULTS(type,status,host,start_date) VALUES('nikto','PENDING','"+req.query.host+"','"+datetime+"');";

	con.query(insert_sql, function (err, result, fields) {
    if(!err){

    	res.status(200).send({ message: result.insertId });
		var filename = ""+result.insertId+"_"+Math.floor(Math.random() * 100000000)+".txt";
			try{
			exec(command,function(err,stdout,stderr){


				if(!err){

					var update_sql = "UPDATE RESULTS SET status='COMPLETE', end_date='"+ new Date()+"',file_name='"+filename+"' where id="+result.insertId+";";
					console.log(update_sql);
					con.query(update_sql, function (err, result, fields) {
						if(!err){
							console.log('Record Updated');
						}
						else{
							console.log("Update Query Error: "+err);
						}
					});

				fs.writeFile('./Results/'+filename+'',stdout, function (err) {
  				if (err) throw err;
  				console.log("File Write Status: "+stdout);
  				});
  
			}

			else{
				fs.writeFile('./Results/'+filename+'',stderr, function (err) {
  				if (err) throw err;
  				console.log("File write Error: "+stderr);
  				});
			}
		});
		}
		catch(_error){
			var update_sql = "UPDATE RESULTS SET status='COMPLETE', end_date='"+ new Date()+"',file_name='"+filename+"' where id="+result.insertId+";";
					console.log(update_sql);
					con.query(update_sql, function (err, result, fields) {
						if(!err){
							console.log('Record Updated');
						}
						else{
							console.log("Update Query Error: "+err);
						}
			});
			fs.writeFile('./Results/'+filename+'',_error, function (err) {
  			if (err) throw err;
  			console.log("File write Error: "+_error);
  			});
		}
	}
	else{res.status(500).send({ message: err });}
	});
});

app.get('/api/wpscan', async function (req, res) {
	exec('wpscan --update',function(err,stdout,stderr){});
	var host = req.query.host;
	var command = 'wpscan --url '+host;
	console.log(command);
	var datetime = new Date();
	var insert_sql = "INSERT INTO RESULTS(type,status,host,start_date) VALUES('wpscan','PENDING','"+req.query.host+"','"+datetime+"');";

	con.query(insert_sql, function (err, result, fields) {
    if(!err){
    	res.status(200).send({ message: result.insertId });
		var filename = ""+result.insertId+"_"+Math.floor(Math.random() * 100000000)+".txt";
			try {
			exec(command,function(err1,stdout,stderr){
				console.log(filename);
				if(!err){

					var update_sql = "UPDATE RESULTS SET status='COMPLETE', end_date='"+ new Date()+"',file_name='"+filename+"' where id="+result.insertId+";";
					console.log(update_sql);
					con.query(update_sql, function (err, result, fields) {
						if(!err) {
							console.log('Record Updated');
						}
						else {
							console.log("Update Query Error: "+err);
						}
					});

				fs.writeFile('./Results/'+filename+'',stdout, function (err) {
  				if (err) throw err;
  				console.log("File Write Status: "+stderr);
  				});
			}

			else {
				console.log(err1);
				fs.writeFile('./Results/'+filename+'',err1, function (err) {
  				if (err) throw err;
  				console.log("File write Error: "+err1);
  				});
			}
		});
		}
		catch(_error)
		{
				var update_sql = "UPDATE RESULTS SET status='COMPLETE', end_date='"+ new Date()+"',file_name='"+filename+"' where id="+result.insertId+";";
					console.log(update_sql);
					con.query(update_sql, function (err, result, fields) {
						if(!err){
							console.log('Record Updated');
						}
						else{
							console.log("Update Query Error: "+err);
						}
			});
			fs.writeFile('./Results/'+filename+'',_error, function (err) {
  			if (err) throw err;
  			console.log("File write Error: "+_error);
  			});
		}
	}
	else {
		res.status(500).send({ message: err });
	}
	});
});

app.get('/api/results', async function (req, res) {
	
	var id = req.query.id;
	con.query("SELECT * FROM RESULTS WHERE id=" + id, function (err, result, fields) {
		if(!err) {
			if(Object.entries(result).length != 0) {

				res.status(200).send({ message: result });
				}
			else {

				res.status(200).send({ message: 'No record Found' });
			}
		}
		else {
			res.status(500).send({ message: err });
		}
	});
});

app.get('/api/file',function(req,res){
	var filename = req.query.file;

	fs.readFile('./Results/'+filename+'', 'utf8', function(err, contents) {
	if (!err){
   	res.status(200).send({ message: contents });
   }
   else{
   	   	res.status(200).send({ message: 'No such File or Directory '});

   }
   });
});
